<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HPC SLURM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../materials/04-software.html" rel="next">
<link href="../materials/02-ssh.html" rel="prev">
<link href="../site_libs/quarto-contrib/quarto-project/cambiotraining/courseformat/img/university-of-cambridge-favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-fd4369bcce5669dc6f092a5d180a1716.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../site_libs/quarto-contrib/quarto-project/cambiotraining/courseformat/img/university_crest_reversed.png" alt="" class="navbar-logo light-content">
    <img src="../site_libs/quarto-contrib/quarto-project/cambiotraining/courseformat/img/university_crest_reversed.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Working on HPC Clusters using SLURM</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://docs.google.com/presentation/d/1KmnSznETddQdRYa6UAXtT-eMOsW7tEwbsOh0fK62c84/edit?usp=sharing"> 
<span class="menu-text">Slides</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/cambiotraining/hpc-intro"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:github" style="font-size: 1.25em;" aria-label="Icon github from fa6-brands Iconify.design set." title="CRIT GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/bioinfocambs.bsky.social"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:bluesky" style="font-size: 1.25em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="CRIT Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://genomic.social/@BioInfoCambs"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:mastodon" style="font-size: 1.25em;" aria-label="Icon mastodon from fa6-brands Iconify.design set." title="CCRIT Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bioinfotraining.bio.cam.ac.uk/"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="mdi:web" style="font-size: 1.25em;" aria-label="Icon web from mdi Iconify.design set." title="CCRIT Website"></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">SLURM Scheduler</span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data &amp; Setup</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Working on a HPC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">HPC Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/02-ssh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Remote Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/03-slurm.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">SLURM Scheduler</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/04-software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Software Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/05-arrays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Job Paralellisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/06-dependencies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Job Dependencies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/07-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">File Transfer</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/appendices/csd3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cambridge University HPC Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materials/appendices/slurm_cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SLURM Quick Reference Guide</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#job-scheduler-overview" id="toc-job-scheduler-overview" class="nav-link active" data-scroll-target="#job-scheduler-overview"><span class="header-section-number">5.1</span> Job Scheduler Overview</a></li>
  <li><a href="#submitting-a-job-with-slurm" id="toc-submitting-a-job-with-slurm" class="nav-link" data-scroll-target="#submitting-a-job-with-slurm"><span class="header-section-number">5.2</span> Submitting a Job with SLURM</a></li>
  <li><a href="#configuring-job-options" id="toc-configuring-job-options" class="nav-link" data-scroll-target="#configuring-job-options"><span class="header-section-number">5.3</span> Configuring Job Options</a>
  <ul class="collapse">
  <li><a href="#partitions" id="toc-partitions" class="nav-link" data-scroll-target="#partitions"><span class="header-section-number">5.3.1</span> Partitions</a></li>
  </ul></li>
  <li><a href="#getting-job-information" id="toc-getting-job-information" class="nav-link" data-scroll-target="#getting-job-information"><span class="header-section-number">5.4</span> Getting Job Information</a>
  <ul class="collapse">
  <li><a href="#exercise-submit-slurm-job" id="toc-exercise-submit-slurm-job" class="nav-link" data-scroll-target="#exercise-submit-slurm-job"><span class="header-section-number">5.4.1</span> Exercise: Submit SLURM job</a></li>
  </ul></li>
  <li><a href="#slurm-environment-variables" id="toc-slurm-environment-variables" class="nav-link" data-scroll-target="#slurm-environment-variables"><span class="header-section-number">5.5</span> SLURM Environment Variables</a>
  <ul class="collapse">
  <li><a href="#exercise-slurm-environment-variables" id="toc-exercise-slurm-environment-variables" class="nav-link" data-scroll-target="#exercise-slurm-environment-variables"><span class="header-section-number">5.5.1</span> Exercise: SLURM environment variables</a></li>
  </ul></li>
  <li><a href="#interactive-login" id="toc-interactive-login" class="nav-link" data-scroll-target="#interactive-login"><span class="header-section-number">5.6</span> Interactive Login</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">5.7</span> Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">SLURM Scheduler</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Describe the role of a job scheduler on a HPC cluster.</li>
<li>Submit a simple job using SLURM and recognise where the output is saved to.</li>
<li>Edit job submission scripts to request non-default resources.</li>
<li>Use SLURM environment variables to customise scripts.</li>
<li>Monitor the progress of a job using commands such as <code>squeue</code> and <code>seff</code>.</li>
<li>Troubleshoot errors during and after job execution.</li>
</ul>
</div>
</div>
<section id="job-scheduler-overview" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="job-scheduler-overview"><span class="header-section-number">5.1</span> Job Scheduler Overview</h2>
<p>As we briefly discussed in “<a href="../materials/01-intro.html">Introduction to HPC</a>”, HPC servers usually have a <strong>job scheduler</strong> software that manages all the jobs that the users submit to be run on the <em>compute nodes</em>. This allows efficient usage of the compute resources (CPUs and RAM), and the user does not have to worry about affecting other people’s jobs.</p>
<p>The job scheduler uses an algorithm to prioritise the jobs, weighing aspects such as:</p>
<ul>
<li>How much time did you request to run your job?</li>
<li>How many resources (CPUs and RAM) do you need?</li>
<li>How many other jobs have you got running at the moment?</li>
</ul>
<p>Based on these, the algorithm will rank each of the jobs in the queue to decide on a “fair” way to prioritise them. Note that this priority dynamically changes all the time, as jobs are submitted or cancelled by the users, and depending on how long they have been in the queue. For example, a job requesting many resources may start with a low priority, but the longer it waits in the queue, the more its priority increases.</p>
<p>In these materials we will cover a job scheduler called <strong>SLURM</strong>, however the way this scheduler works is very similar to other schedulers. The specific commands may differ, but the functionality is the same (see <a href="https://slurm.schedmd.com/rosetta.pdf">this document</a> for matching commands to other job sheculers).</p>
</section>
<section id="submitting-a-job-with-slurm" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="submitting-a-job-with-slurm"><span class="header-section-number">5.2</span> Submitting a Job with SLURM</h2>
<p>To submit a job to SLURM, you need to include your code in a <em>shell script</em>. Let’s start with a minimal example, found in our workshop data folder “slurm”.</p>
<p>Our script is called <code>simple_job.sh</code> and contains the following code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sleep</span> 60 <span class="co"># hold for 60 seconds</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"This job is running on:"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hostname</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We can run this script from the login node using the <code>bash</code> interpreter (make sure you are in the correct directory first: <code>cd ~/rds/hpc-work/hpc_workshop/</code>):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> job_scripts/simple_job.sh</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Which prints the output:</p>
<pre><code>This job is running on:
login-node</code></pre>
<p>To submit the job to the scheduler we instead use the <code>sbatch</code> command in a very similar way:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> job_scripts/simple_job.sh</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In this case, we are informed that the job is submitted to the SLURM queue. We can see all the jobs in the queue with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">squeue</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>JOBID  PARTITION      NAME      USER  ST  TIME  NODES  NODELIST(REASON)
  193   training  simple_j  particip   R  0:02      1  training-dy-t2medium-2</code></pre>
<p>This gives a list of all the jobs running, with their “status” (ST column), which is usually:</p>
<ul>
<li><code>PD</code> for a pending job, meaning the job is waiting the queue to get started.</li>
<li><code>R</code> for a running job, meaning the job is currently running on one of the compute nodes.</li>
</ul>
<p>But if our job is running on a compute node, where does the output go? Instead of being printed to the terminal, the output of this script will be saved to a file. By default the file is named <code>slurm-JOBID.out</code>, where “JOBID” is a number corresponding to the job ID assigned to the job by the scheduler. This file will be located in the same directory where you launched the job from.</p>
<p>We can investigate the output by looking inside the file, for example <code>cat slurm-JOBID.out</code>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The first line of the shell scripts <code>#!/bin/bash</code> is called a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)"><em>shebang</em></a> and indicates which program should interpret this script. In this case, <em>bash</em> is the interpreter of <em>shell</em> scripts (there’s other shell interpreters, but that’s beyond what we need to worry about here).</p>
<p>Remember to <strong>always have this as the first line of your script</strong>. If you don’t, <code>sbatch</code> will throw an error.</p>
</div>
</div>
</section>
<section id="configuring-job-options" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="configuring-job-options"><span class="header-section-number">5.3</span> Configuring Job Options</h2>
<p>Although the above example works, our job just ran with the default options that SLURM was configured with. Instead, we usually want to customise our job, by specifying options at the top of the script using the <code>#SBATCH</code> keyword, followed by the SLURM option.</p>
<p>For example, one option we may want to change in our previous script is the name of the file to where our standard output is written to. We can do this using the <code>-o</code> option.</p>
<p>Here is how we could modify our script (you can do it using <em>Nano</em> or <em>VS Code</em>):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o job_logs/simple_job.log</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sleep</span> 8 <span class="co"># hold for 8 seconds</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"This job is running on:"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hostname</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If we now re-run the script using <code>sbatch simple_job.sh</code>, the output goes to a file named <code>simple_job.log</code>.</p>
<p>There are several other options we can specify when using SLURM, and we will encounter several more of them as we progress through the materials. Here are some of the most common ones (anything in <code>&lt;&gt;</code> is user input):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 84%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Command</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>-D &lt;path&gt;</code></td>
<td style="text-align: left;"><em>working directory</em> used for the job. This is the directory that SLURM will use as a reference when running the job.</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>-o &lt;path/filename&gt;</code></td>
<td style="text-align: left;">file where the output that would normally be printed on the console is saved in. This is defined <em>relative</em> to the working directory set above.</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>-A &lt;name&gt;</code></td>
<td style="text-align: left;">billing account. This is sometimes needed if you’re using HPC servers that charge you for their use. This information should be provided by your HPC admins.</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>-p &lt;name&gt;</code></td>
<td style="text-align: left;"><em>partition</em> name. See details in the following section.</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>-c &lt;number&gt;</code></td>
<td style="text-align: left;">the number of CPUs you want to use for your job.</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>-t &lt;HH:MM:SS&gt;</code></td>
<td style="text-align: left;">the time you need for your job to run. This is not always easy to estimate in advance, so if you’re unsure you may want to request a good chunk of time. However, the more time you request for your job, the lower its priority in the queue.</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>--mem=&lt;number&gt;GB</code></td>
<td style="text-align: left;">how much RAM memory you want for your job in gigabytes.</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>-J &lt;name&gt;</code></td>
<td style="text-align: left;">a name for the job.</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Default Resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you don’t specify any options when submitting your jobs, you will get the default configured by the HPC admins. For example, in our Cambridge HPC, the defaults you will get are:</p>
<ul>
<li>10 minutes of running time (equivalent to <code>-t 00:10:00</code>)</li>
<li><em>cclake</em> partition (equivalent to <code>-p cclake</code>)</li>
<li>1 CPU (equivalent to <code>-c 1</code>)</li>
<li>~3.4 GiB RAM (equivalent to <code>--mem=3.4G</code>)</li>
</ul>
</div>
</div>
<section id="partitions" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="partitions"><span class="header-section-number">5.3.1</span> Partitions</h3>
<p>Often, HPC servers have different types of compute node setups (e.g.&nbsp;queues for fast jobs, or long jobs, or high-memory jobs, etc.). SLURM calls these “partitions” and you can use the <code>-p</code> option to choose which partition your job runs on. Usually, which partitions are available on your HPC should be provided by the admins.</p>
<p>It’s worth keeping in mind that partitions have separate queues, and you should always try to choose the partition that is most suited to your job.</p>
<p>For example, on the Cambridge HPC we have several partitions, here are two examples:</p>
<ul>
<li><code>cclake</code> partition (default)
<ul>
<li>Maximum 56 CPUs (default: 1)</li>
<li>Maximum 3928 MB RAM (default: 1024)</li>
</ul></li>
<li><code>traininglarge</code> partition
<ul>
<li>Maximum 8 CPUs (default: 1)</li>
<li>Maximum 31758 MB RAM (default: 1024)</li>
</ul></li>
</ul>
</section>
</section>
<section id="getting-job-information" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="getting-job-information"><span class="header-section-number">5.4</span> Getting Job Information</h2>
<p>After submitting a job, we may want to know:</p>
<ul>
<li>What is going on with my job? Is it running or has it finished?</li>
<li>If it finished, did it finish successfully, or did it fail?</li>
<li>How many resources (e.g.&nbsp;RAM) did it use?</li>
<li>What if I want to cancel a job because I realised there was a mistake in my script?</li>
</ul>
<p>We’ve already seen the <code>squeue</code> command to check the <strong>status of your jobs</strong>. Without any options you will get <em>all</em> jobs in the queue (yours and other users’), to see only your jobs you can do:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="op">&lt;</span>user<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This gives you information about the job’s status: <code>PD</code> means it’s <em>pending</em> (waiting in the queue) and <code>R</code> means it’s <em>running</em> on a compute node.</p>
<p>To see more <strong>information for a job</strong> (and whether it completed or failed), you can use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">seff</span> JOBID</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows you the status of the job (running, completed, failed), how many cores it used, how long it took to run and how much memory it used. Therefore, this command is very useful to determine suitable resources (e.g.&nbsp;RAM, time) next time you run a similar job.</p>
<p>Alternatively, you can use the <code>sacct</code> command, which allows displaying this and other information in a more condensed way (and for multiple jobs if you want to).</p>
<p>For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">--format</span> JobName,Account,State,AllocCPUs,ReqMem,MaxRSS,AveRSS,Elapsed <span class="at">-j</span> JOBID</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>JobName</code> is the job’s name</li>
<li><code>Account</code> is the account used for the job</li>
<li><code>State</code> gives you the state of the job</li>
<li><code>AllocCPUs</code> is the number of CPUs you requested for the job</li>
<li><code>ReqMem</code> is the memory that you asked for (Mc or Gc indicates MB or GB per core; Mn or Gn indicates MB or GB per node)</li>
<li><code>MaxRSS</code> is the maximum memory used during the job <em>per core</em></li>
<li><code>AveRSS</code> is the average memory used <em>per core</em></li>
<li><code>Elapsed</code> how much time it took to run your job</li>
</ul>
<p>All the format options available with <code>sacct</code> can be listed using <code>sacct -e</code>.</p>
<p>If you <strong>forgot what your job id is</strong>, running <code>sacct</code> with no other options will show you information about the jobs that ran recently. If you want to know the ID of jobs that ran in a period of time, you can do:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">-S</span> 2024-01-01 <span class="at">-E</span> 2024-02-01 <span class="at">--format</span><span class="op">=</span>JobID,JobName,Start,End,State</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, <code>-S</code> is the start date and <code>-E</code> the end date of the time period you want to list jobs for. You can omit the <code>-E</code> option, in which case it will list all the jobs that ran up to the current date.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>sacct</code> command may not be available on every HPC, as it depends on how it was configured by the admins.</p>
</div>
</div>
<p>You can also see more details about a job, such as the working directory and output directories, using:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scontrol</span> show job <span class="op">&lt;</span>JOBID<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Finally, if you want to <strong>cancel a job</strong>, you can use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> <span class="op">&lt;</span>JOBID<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And to cancel all your jobs simultaneously: <code>scancel -u &lt;USERNAME&gt;</code> (you will not be able to cancel other people’s jobs, so don’t worry about it).</p>
<section id="exercise-submit-slurm-job" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="exercise-submit-slurm-job"><span class="header-section-number">5.4.1</span> Exercise: Submit SLURM job</h3>
<div class="callout callout-style-default callout-exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Exercise</span>Exercise 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="callout-exercise">
<p>Before starting this exercise:</p>
<ul>
<li>Make sure you are in the workshop folder (<code>cd ~/rds/hpc-work/hpc_workshop</code>).</li>
<li>Activate a software environment needed for the exercise (we will cover the details in the <a href="../materials/04-software.html">Software Management</a> chapter): <code>mamba activate base</code>
<ul>
<li>Your prompt should now start with the prefix <code>(base)</code></li>
</ul></li>
</ul>
<p>In the “analysis_scripts” directory, you will find an R script called <code>pi_estimator.R</code>. This script tries to get an approximate estimate for the number Pi using a stochastic algorithm.</p>
<details>
<summary>
How does the algorithm work?
</summary>
<p>If you are interested in the details, here is a short description of what the script does:</p>
<blockquote class="blockquote">
<p>The program generates a large number of random points on a 1×1 square centered on (½,½), and checks how many of these points fall inside the unit circle. On average, π/4 of the randomly-selected points should fall in the circle, so π can be estimated from 4f, where f is the observed fraction of points that fall in the circle. Because each sample is independent, this algorithm is easily implemented in parallel.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://carpentries-incubator.github.io/hpc-intro/fig/pi.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Estimating Pi by randomly placing points on a quarter circle. (Source: <a href="https://carpentries-incubator.github.io/hpc-intro/16-parallel/index.html">HPC Carpentry</a>)</figcaption>
</figure>
</div>
</details>
<p>If you were running this script interactively (i.e.&nbsp;directly from the console), you would use the R script interpreter: <code>Rscript analysis_scripts/pi_estimator.R</code>. Instead, we use a shell script to submit this to the job scheduler.</p>
<ol type="1">
<li>Edit the shell script in <code>job_scripts/estimate_pi.sh</code> by correcting your username in the working directory path (under <code>#SBATCH -D</code>). Submit the job to SLURM and check its status in the queue.</li>
<li>Did your job run successfully, and how long did it take to run?</li>
<li>The number of samples used to estimate Pi can be modified using the <code>--nsamples</code> option of our script, defined in millions. The more samples we use, the more precise our estimate should be.
<ul>
<li>Adjust your SLURM submission script to use 50 million samples (<code>Rscript analysis_scripts/pi_estimator.R --nsamples 50</code>), and save the job output in <code>job_logs/estimate_pi_50M.log</code>.</li>
<li>Monitor the job status with <code>squeue</code> and <code>seff JOBID</code>. Do you find any issues? How would you fix it?</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-hint no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hint</span>Hint
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="callout-hint">
<ul>
<li>Use <code>seff JOBID</code> or <code>scontrol show job JOBID</code> to see job details.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-answer no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Answer</span>Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="callout-answer">
<p><strong>A1.</strong></p>
<p>In the shell script we needed to correct the path specified in the <code>#SBATCH -D</code> option, which defines the working directory that SLURM will run our code from. We needed to replace “FIX-YOUR-USERNAME” with our actual username.</p>
<p>We could then submit the script using <code>sbatch job_scripts/estimate_pi.sh</code>. And check the status of the job with <code>squeue -u USERNAME</code> (using our respective username).</p>
<p>Because the job runs very fast, we may not have time to see it in the queue at all. However, we can check if it ran successfully in the next step.</p>
<p><strong>A2.</strong></p>
<p>As suggested in the hint, we can use the <code>seff</code> or <code>scontrol</code> commands to check whether our job was successful and how long it took:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">seff</span> JOBID</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">scontrol</span> show job JOBID</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Replacing JOBID with the ID of the job we just ran.</p>
<p>If you cannot remember what the job id was, you can run <code>sacct</code> with no other options and it will list the last few jobs that you ran.</p>
<p>Sometimes it may happen that the “Memory Utilized” is reported as 0.00MB or a lower value than you would expect. That’s very odd, since for sure our script must have used <em>some</em> memory to do the computation. The reason is that SLURM doesn’t always have time to pick memory usage spikes, and so it reports a zero. This is usually not an issue with longer-running jobs.</p>
<p><strong>A3.</strong></p>
<p>The modified script should look similar to this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -p training </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -D /home/USERNAME/rds/hpc-work/hpc_workshop/  # working directory</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o job_logs/estimate_pi_50M.log  # standard output file</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -c 1        # number of CPUs. Default: 1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -t 00:10:00 # time for the job HH:MM:SS.</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># run the script</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> analysis_scripts/pi_estimator.R <span class="at">--nsamples</span> 50</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>However, when we run this job, examining the output file (<code>cat job_logs/estimate_pi_50M.log</code>) will reveal an error indicating that our job was killed.</p>
<pre><code>/var/spool/slurmd/job02038/slurm_script: line 9:  6682 Killed                  Rscript analysis_scripts/pi_estimator.R --nsamples 50
slurmstepd: error: Detected 1 oom-kill event(s) in StepId=2038.batch cgroup. Some of your processes may have been killed by the cgroup out-of-memory handler.</code></pre>
<p>Furthermore, if we use <code>seff</code> to get information about the job, it will show <code>State: OUT_OF_MEMORY (exit code 0)</code>.</p>
<p>This suggests that the job required more memory than we requested. We can also check this by seeing what <code>seff</code> reports as “Memory Utilized” and see that it exceeded the requested 1GB (although sometimes it shows much less than that, if it ran too fast and SLURM didn’t register the memory usage peak).</p>
<p>To correct this problem, we would need to increase the memory requested to SLURM, adding to our script, for example, <code>#SBATCH --mem=3G</code> to request 3Gb of RAM memory for the job.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="slurm-environment-variables" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="slurm-environment-variables"><span class="header-section-number">5.5</span> SLURM Environment Variables</h2>
<p>One useful feature of SLURM jobs is the automatic creation of environment variables. Generally speaking, variables are a character that store a value within them, and can either be created by us, or sometimes they are automatically created by programs or available by default in our shell.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>More about shell variables (click to view)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>An example of a common shell environment variable is <code>$HOME</code>, which stores the path to the user’s <code>/home</code> directory. We can print the value of a variable with <code>echo $HOME</code>.</p>
<p>The syntax to create a variable ourselves is:</p>
<pre class="shell"><code>VARIABLE="value"</code></pre>
<p>Notice that there should be <strong>no space between the variable name and its value</strong>.</p>
<p>If you want to create a variable with the result of evaluating a command, then the syntax is:</p>
<pre class="shell"><code>VARIABLE=$(command)</code></pre>
<p>Try these examples:</p>
<pre class="shell"><code># Make a variable with a path starting from the user's /home
DATADIR="$HOME/rds/hpc-work/data/"

# list files in that directory
ls $DATADIR

# create a variable with the output of that command
DATAFILES=$(ls $DATADIR)</code></pre>
</div>
</div>
</div>
<p>When you submit a job with SLURM, it creates several variables, all starting with the prefix <code>$SLURM_</code>. One useful variable is <code>$SLURM_CPUS_PER_TASK</code>, which stores how many CPUs we requested for our job. This means that we can use the variable to automatically set the number of CPUs for software that support multi-processing. We will see an example in the following exercise.</p>
<p>Here is a table summarising some of the most useful environment variables that SLURM creates:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>$SLURM_CPUS_PER_TASK</code></td>
<td style="text-align: left;">Number of CPUs requested with <code>-c</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>$SLURM_JOB_ID</code></td>
<td style="text-align: left;">The job ID</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>$SLURM_JOB_NAME</code></td>
<td style="text-align: left;">The name of the job defined with <code>-J</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>$SLURM_SUBMIT_DIR</code></td>
<td style="text-align: left;">The working directory defied with <code>-D</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>$SLURM_ARRAY_TASK_ID</code></td>
<td style="text-align: left;">The number of the sub-job when running parallel arrays (covered in the <a href="../materials/05-arrays.html">Job Arrays</a> section)</td>
</tr>
</tbody>
</table>
<section id="exercise-slurm-environment-variables" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="exercise-slurm-environment-variables"><span class="header-section-number">5.5.1</span> Exercise: SLURM environment variables</h3>
<div class="callout callout-style-default callout-exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Exercise</span>Exercise 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="callout-exercise">
<p>Before starting this exercise:</p>
<ul>
<li>Make sure you are in the workshop folder (<code>cd ~/rds/hpc-work/hpc_workshop</code>).</li>
<li>Activate a software environment needed for the exercise (we will cover the details in the <a href="../materials/04-software.html">Software Management</a> chapter): <code>mamba activate base</code>
<ul>
<li>Your prompt should now start with the prefix <code>(base)</code></li>
</ul></li>
</ul>
<p>The R script used in the previous exercise supports parallelisation of some of its internal computations. The number of CPUs used by the script can be modified using the <code>--ncpus</code> option. For example <code>pi_estimator.R --nsamples 200 --ncpus 2</code> would use two CPUs.</p>
<ol type="1">
<li>Modify your submission script (<code>job_scripts/estimate_pi.sh</code>) to: <!-- 1. Use the `traininglarge` partition (the nodes in the default `training` partition only have 2 CPUs). -->
<ol type="1">
<li>Use the <code>$SLURM_CPUS_PER_TASK</code> variable to set the number of CPUs used by <code>pi_estimator.R</code> (and ensure you have set <code>--nsamples 200</code> as well).</li>
<li>Request 3 CPUs and 9G of RAM memory for the job.</li>
<li>Bonus (optional): use <code>echo</code> within the script to print a message indicating the job number (SLURM’s job ID is stored in the variable <code>$SLURM_JOB_ID</code>).</li>
</ol></li>
<li>Submit the job again but this time requesting 8 CPUs. Make a note of each job’s ID.</li>
<li>Check how much time each job took to run (using <code>seff JOBID</code>). Did increasing the number of CPUs shorten the time it took to run?</li>
</ol>
<div class="callout callout-style-default callout-answer no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Answer</span>Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="callout-answer">
<p><strong>A1.</strong></p>
<p>We can modify our submission script in the following manner, requesting 3 CPUs and 9GB or RAM:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -A TRAINING-CPU</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -p icelake  # name of the partition to run job on</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -D /home/FIX-YOUR-USERNAME/rds/hpc-work/hpc_workshop/  # working directory</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o job_logs/estimate_pi_200M_3CPU.log  # standard output file</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -c 3        # number of CPUs. Default: 1</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=9G    # RAM memory. Default: 1G</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -t 00:10:00 # time for the job HH:MM:SS. Default: 1 min</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># launch the Pi estimator script using the number of CPUs that we are requesting from SLURM</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> analysis_scripts/pi_estimator.R <span class="at">--nsamples</span> 200 <span class="at">--ncpus</span> <span class="va">$SLURM_CPUS_PER_TASK</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To run the job each time, we modify the <code>#SBATCH -c</code> option, save the file and then re-submit it with <code>sbatch job_scripts/estimate_pi.sh</code>.</p>
<p>After running each job we can use <code>seff JOBID</code> command to obtain information about how long it took to run.</p>
<p>Alternatively, since we want to compare several jobs, we could also have used <code>sacct</code> like this:</p>
<p><code>sacct -o JobID,elapsed -j JOBID1,JOBID2</code></p>
<p>In this case, it doesn’t seem that increasing the number of CPUs from 3 to 8 shortens the time the job takes to run. It is often the case that the time to run a parallelised tasks doesn’t scale linearly, which is likely because there are other computational costs to do with this kind of parallelisation (e.g.&nbsp;keeping track of what each parallel thread is doing).</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="interactive-login" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="interactive-login"><span class="header-section-number">5.6</span> Interactive Login</h2>
<p>Sometimes it may be useful to directly get a terminal on one of the compute nodes. This may be useful, for example, if you want to test some scripts or run some code that you think might be too demanding for the login node (e.g.&nbsp;to compress some files).</p>
<p>It is possible to get interactive access to a terminal on one of the compute nodes using the <code>sintr</code> command. This command takes options similar to the <code>sbatch</code> program, so you can request resources in the same way you would when submitting scripts.</p>
<p>For example, to access to 8 CPUs and 10GB of RAM for 1h on one of the compute nodes we would do:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sintr</span> <span class="at">-c</span> 8 <span class="at">--mem</span><span class="op">=</span>10G <span class="at">-p</span> icelake <span class="at">-t</span> 01:00:00 <span class="at">-A</span> TRAINING-CPU</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You may get a message saying that SLURM is waiting to allocate your request (you go in the queue, just like any other job!). Eventually, when you get in, you will notice that your terminal will indicate you are on a different node (different from the login node). You can check by running <code>hostname</code>.</p>
<p>After you’re in, you can run any commands you wish, without worrying about affecting other users’ work. Once you are finished, you can use the command <code>exit</code> to terminate the session, and you will go back to the login node.</p>
<p>Note that, if the time you requested (with the <code>-t</code> option) runs out, your session will be immediately killed.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Use interactive jobs ethically
</div>
</div>
<div class="callout-body-container callout-body">
<p>The main purpose of interactive jobs is to quickly test code or to run routine tasks such as compressing/uncompressing large files. You should not use interactive jobs for your actual analysis.</p>
<p>The main reason is that interactive jobs require users to actively monitor and manage their tasks, which may not be the most efficient use of their time. This may also result in congesting the job queue, causing delays for other users with batch jobs waiting to be processed. Furthermore, batch jobs can be scheduled to run during off-peak hours, allowing users to focus on other tasks while their computations are being processed.</p>
<p>For this reason, some HPC clusters are configured to limit the time for interactive jobs (for example, at Cambridge University these are limited to 1h).</p>
</div>
</div>
</section>
<section id="summary" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="summary"><span class="header-section-number">5.7</span> Summary</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Key Points
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Include the commands you want to run on the HPC in a shell script.
<ul>
<li>Always remember to include <code>#!/bin/bash</code> as the first line of your script.</li>
</ul></li>
<li>Submit jobs to the scheduler using <code>sbatch submission_script.sh</code>.</li>
<li>Customise the jobs by including <code>#SBATCH</code> options at the top of your script (see table in the materials above for a summary of options).
<ul>
<li>As a good practice, always define an output file with <code>#SBATCH -o</code>. All the information about the job will be saved in that file, including any errors.</li>
</ul></li>
<li>Check the status of a submitted job by using <code>squeue -u USERNAME</code> and <code>seff JOBID</code>.</li>
<li>To cancel a running job use <code>scancel JOBID</code>.</li>
</ul>
<p>See this <a href="https://slurm.schedmd.com/pdfs/summary.pdf">SLURM cheatsheet</a> for a summary of the available commands.</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../materials/02-ssh.html" class="pagination-link" aria-label="Remote Work">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Remote Work</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../materials/04-software.html" class="pagination-link" aria-label="Software Management">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Software Management</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Licensed <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> <img src="https://creativecommons.org/images/deed/cc_icon_black_x2.png" class="img-fluid" width="25"> Cambridge Research Informatics Training</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>